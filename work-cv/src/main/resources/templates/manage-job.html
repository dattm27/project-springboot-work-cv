<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Quản lý tuyển dụng - Work CV</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

	<meta name="_csrf" th:content="${_csrf.token}" />
</head>

<body>
	<!--Thêm navbar -->
	<nav th:replace="fragments :: navbar"></nav>
	<div class="container">
		<h3 class="mt-2">Danh sách công việc</h3>
		<div>
			<table class="table  table-hover">
				<thead>
					<tr class="d-flex">
						<th class="col-3">Tiêu đề</th>
						<th class="col-1">Loại</th>
						<th class="col-3">Địa điểm làm việc</th>
						<th class="col-2">Lương</th>
						<th class="col-3">Thao tác</th>
					</tr>
				</thead>
				<tbody>
					<!-- Sử dụng vòng lặp để hiển thị thông tin công việc -->
					<tr th:each="job : ${jobs}" class="d-flex">
						<td th:text="${job.title}" class="col-3"></td>
						<td th:text="${job.type}" class="col-1"></td>

						<td class="col-3" th:text="${job.address}">

						</td>
						<td th:text="${job.salary}" class="col-2"></td>
						<td class="col-3">
							<a th:href="@{/job/details/{jobId}(jobId=${job.id})}" class="btn btn-primary">Chi tiết</a>
							<a href="#" class="btn btn-warning">Cập nhật</a>
							<button class="btn btn-danger" th:onclick="'deleteJob(' + ${job.id} + ')'">Xoá</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>




	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		<!--Xử lý yêu cầu xoá một công việc-->
		function deleteJob(jobId) {
			var csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
			if (confirm("Bạn có chắc muốn xoá công việc này không?")) {
				// Gửi yêu cầu DELETE đến server
				fetch('deleteJob/' + jobId, {
					method: 'DELETE',
					headers: {
						'X-CSRF-TOKEN': csrfToken
					}
				})
					.then(response => {
						if (response.ok) {
							// Xoá thành công, có thể cập nhật giao diện nếu cần
							// Ví dụ: reload danh sách công việc
							location.reload();
						} else {
							// Xử lý khi có lỗi xoá công việc
							console.error('Xoá công việc thất bại');
						}
					})
					.catch(error => {
						console.error('Lỗi khi xoá công việc:', error);
					});
			}
		}

	</script>

</body>

</html>